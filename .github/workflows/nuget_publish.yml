name: NuGet Publish

on:
    workflow_dispatch:
        inputs:
            confirmPublish:
                description: "Publish WinPath.Library (Y/N)?"
                required: true
                default: "Y"

jobs:
    nuget-publish:
        runs-on: windows-latest

        steps:
            - name: Checkout
              uses: actions/checkout@v2
            - name: Setup .NET Core
              uses: actions/setup-dotnet@v1
              with:
                  source-url: https://api.nuget.org/v3/index.json
                  dotnet-version: "5.0.x"
              env:
                  NUGET_AUTH_TOKEN: ${{ secrets.NUGET_TOKEN }}
            - name: Install dependencies
              run: cd .\WinPath.Library && dotnet restore

            - name: Publish WinPath.Library
              if: github.event.inputs.confirmPublish == 'Y'
              run: |
                  cd .\WinPath.Library
                  mkdir __out
                  dotnet build -c Release
                  dotnet pack WinPath.Library.csproj -c Release -o __out
                  dotnet nuget push ./__out/*.nupkg --skip-duplicate --no-symbols true --api-key ${{ secrets.NUGET_TOKEN }} --source "https://api.nuget.org/v3/index.json"
